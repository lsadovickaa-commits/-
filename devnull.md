# Задание №18
# Задача о рюкзаке. Метод ветвей и границ.

Необходимо: 
1. Решить задачу о рюкзаке с применением метода ветвей и границ.
2. Оформить решение задачи по шагам с подробными комментариями, таблицами и диаграммами.
3. **В узлах построенного дерева привести расчет оценки и указать порядковый номер, по которым можно проверить порядок исследования узлов дерева**, либо оформить решение с пошаговым построением дерева (как в примере ниже).
4. В ответе указать:
   - максимально возможную стоимость предметов в рюкзаке,
   - набор предметов, обеспечивающих максимальную стоимость,
   - общий вес предметов в рюкзаке,
   - свободное место в рюкзаке.


## Условия задачи
| Предметы  |  A  | B |  C  | D | E | F |
|:----------|:---:|:-:|:---:|:-:|:-:|:-:|
| Стоимость |  5  | 5 |  3  | 8 | 6 | 8 |
| Вес       | 10  | 5 | 12  | 4 | 2 | 2 |

Ограничение вместимости - 20 у.е.

## Шаг 1
Сортируем предметы по их ценности $(\frac {Стоимость}{вес})$

|    **Предметы**   | **F** | **E** | **D** | **B** | **A** | **C** |
|-------------------|:-----:|:-----:|:-----:|:-----:|:-----:|:-----:|
| **Стоимость**     |   8   |   6   |   8   |   5   |   5   |   3   |
| **Вес**           |   2   |   2   |   4   |   5   |  10   |  12   |
| **Ценность**      |   4   |   3   |   2   |   1   |$\frac{1}{2}$|$\frac{1}{4}$|

## Шаг 2
Представим, что самого ценного предмета из тех, что еще не обработаны, у нас бесконечное количество и мы можем делить его на сколь угодно малые части. Тогда мы можем все оставшееся в рюкзаке место заполнить этим предметом. Тогда ценность будет

$$
4 * 20 = 80
$$

Это значение будет корнем нашего дерева, оно представляет оценку перспективности для задачи в целом.

## Шаг 3
Разобьем множество решений на два подмножества и начнем строить дерево. Левым потомком будет подмножество решений, в которых мы взяли самый ценный из оставшихся предметов, правым - где не взяли. 

Оценка перспективности левого потомка = 

$$
8 + (20 - 2) * 3 = 62 
$$

Оценка перспективности правого потомка = 

$$
20 * 3 = 60
$$


``` mermaid
flowchart TD
A(80)
B(62)
C(60)
A -- +F--> B
A -- -F--> C

style B fill:#4f4f
```

Повторяем шаг 3 и продолжаем строить дерево из самой перспективной вершины.

Оценка перспективности левого потомка -

$$
8 + 6 + (20 - 2 - 2) * 2 = 14 + 16 * 2 = 46 
$$

Оценка перспективности правого потомка - 

$$
8 + (20 - 2) * 2 = 44
$$

``` mermaid
flowchart TD
A(80)
B(62)
C(60)
D(46)
E(44)
A -- +F--> B
A -- -F--> C
B -- +E--> D
B -- -E--> E

style C fill:#4f4f
```

Заметим, что самая перспективная вершина оказалась на другой ветке. Продолжаем строить из вершины с оценкой 60.

Оценка перспективности левого потомка -

$$
6 + (20 - 2) * 2 = 6 + 18 * 2 = 42 
$$

Оценка перспективности правого потомка - 

$$
20 * 2 = 40
$$

``` mermaid
flowchart TD
A(80)
B(62)
C(60)
D(46)
E(44)
F(42)
G(40)
A -- +F--> B
A -- -F--> C
B -- +E--> D
B -- -E--> E
C -- +E--> F
C -- -E--> G

style D fill:#4f4f
```

Самая перспективная вершина - 46.

Оценка перспективности левого потомка -

$$
14 + 8 + (20 - 8) * 1 = 22 + 12 * 1 = 34
$$

Оценка перспективности правого потомка - 

$$
14 + 16 * 1 = 30
$$

``` mermaid
flowchart TD
A(80)
B(62)
C(60)
D(46)
E(44)
F(42)
G(40)
H(34)
I(30)
A -- +F--> B
A -- -F--> C
B -- +E--> D
B -- -E--> E
C -- +E--> F
C -- -E--> G
D -- +D--> H
D -- -D--> I

style E fill:#4f4f
```

Самая перспективная вершина - 44.

Оценка перспективности левого потомка -

$$
8 + 8 + (20 - 6) * 1 = 16 + 14 * 1 = 30
$$

Оценка перспективности правого потомка - 

$$
8 + 18 * 1 = 26
$$

``` mermaid
flowchart TD
A(80)
B(62)
C(60)
D(46)
E(44)
F(42)
G(40)
H(34)
I(30)
J(30)
K(26)
A -- +F--> B
A -- -F--> C
B -- +E--> D
B -- -E--> E
C -- +E--> F
C -- -E--> G
D -- +D--> H
D -- -D--> I
E -- +D--> J
E -- -D--> K

style F fill:#4f4f
```

Самая перспективная вершина - 42.

Оценка перспективности левого потомка -

$$
6 + 8 + (20 - 6) * 1 = 14 + 14 * 1 = 28
$$

Оценка перспективности правого потомка - 

$$
6 + 18 * 1 = 24
$$

``` mermaid
flowchart TD
A(80)
B(62)
C(60)
D(46)
E(44)
F(42)
G(40)
H(34)
I(30)
J(30)
K(26)
L(28)
M(24)
A -- +F--> B
A -- -F--> C
B -- +E--> D
B -- -E--> E
C -- +E--> F
C -- -E--> G
D -- +D--> H
D -- -D--> I
E -- +D--> J
E -- -D--> K
F -- +D--> L
F -- -D--> M

style G fill:#4f4f
```

Самая перспективная вершина - 40.

Оценка перспективности левого потомка -

$$
8 + (20 - 4) * 1 = 8 + 16 * 1 = 24
$$

Оценка перспективности правого потомка - 

$$
20 * 1 = 20
$$

``` mermaid
flowchart TD
A(80)
B(62)
C(60)
D(46)
E(44)
F(42)
G(40)
H(34)
I(30)
J(30)
K(26)
L(28)
M(24)
N(24)
AK(20)
A -- +F--> B
A -- -F--> C
B -- +E--> D
B -- -E--> E
C -- +E--> F
C -- -E--> G
D -- +D--> H
D -- -D--> I
E -- +D--> J
E -- -D--> K
F -- +D--> L
F -- -D--> M
G -- +D--> N
G -- -D--> AK

style H fill:#4f4f
```

Самая перспективная вершина - 34.

Оценка перспективности левого потомка -

$$
22 + 5 + (20 - 13) * \frac{1}{2} = 27 + 7 * \frac{1}{2} = 30,5
$$

Оценка перспективности правого потомка - 

$$
22 + 12 * \frac{1}{2} = 28
$$

``` mermaid
flowchart TD
A(80)
B(62)
C(60)
D(46)
E(44)
F(42)
G(40)
H(34)
I(30)
J(30)
K(26)
L(28)
M(24)
N(24)
AK(20)
O(30,5)
P(28)
A -- +F--> B
A -- -F--> C
B -- +E--> D
B -- -E--> E
C -- +E--> F
C -- -E--> G
D -- +D--> H
D -- -D--> I
E -- +D--> J
E -- -D--> K
F -- +D--> L
F -- -D--> M
G -- +D--> N
G -- -D--> AK
H -- +B--> O
H -- -B--> P

style O fill:#4f4f
```

Самая перспективная вершина - 30,5.

Оценка перспективности левого потомка -

$$
27 + 5 + (20 - 23) * \frac{1}{4} = 32 + -3 * \frac{1}{4} 
$$
Получили отрицательное значение, что значит предмет не поместится в рюкзак. Соответственно от этой вершины мы не будем продолжать поиск.

Оценка перспективности правого потомка - 

$$
27 + 7 * \frac{1}{4} = 28,75
$$

``` mermaid
flowchart TD
A(80)
B(62)
C(60)
D(46)
E(44)
F(42)
G(40)
H(34)
I(30)
J(30)
K(26)
L(28)
M(24)
N(24)
AK(20)
O(30,5)
P(28)
R(0)
S(28,75)
A -- +F--> B
A -- -F--> C
B -- +E--> D
B -- -E--> E
C -- +E--> F
C -- -E--> G
D -- +D--> H
D -- -D--> I
E -- +D--> J
E -- -D--> K
F -- +D--> L
F -- -D--> M
G -- +D--> N
G -- -D--> AK
H -- +B--> O
H -- -B--> P
O -- +A--> R
O -- -A--> S

style R fill:#FF0000
style I fill:#4f4f
style J fill:#4f4f
```

Самые перспективные вершины - 30.

Оценка перспективности левых потомков -

$$
14 + 5 + (20 - 9) * \frac{1}{2} = 19 + 11 * \frac{1}{2} = 24,5
$$
$$
16 + 5 + (20 - 11) * \frac{1}{2} = 21 + 9 * \frac{1}{2} = 25,5
$$

Оценка перспективности правых потомов - 

$$
14 + 16 * \frac{1}{2} = 22
$$

$$
16 + 14 * \frac{1}{2} = 23
$$

``` mermaid
flowchart TD
A(80)
B(62)
C(60)
D(46)
E(44)
F(42)
G(40)
H(34)
I(30)
J(30)
K(26)
L(28)
M(24)
N(24)
AK(20)
O(30,5)
P(28)
R(0)
S(28,75)
T(24,5)
U(22)
V(25,5)
W(23)
A -- +F--> B
A -- -F--> C
B -- +E--> D
B -- -E--> E
C -- +E--> F
C -- -E--> G
D -- +D--> H
D -- -D--> I
E -- +D--> J
E -- -D--> K
F -- +D--> L
F -- -D--> M
G -- +D--> N
G -- -D--> AK
H -- +B--> O
H -- -B--> P
O -- +A--> R
O -- -A--> S
I -- +B--> T
I -- -B--> U
J -- +B--> V
J -- -B--> W

style R fill:#FF0000
style S fill:#4f4f
```
Самая перспективная вершина - 28,75.

Оценка перспективности левого потомка -

$$
27 + 3 + (20 - 25) * 0 = 30 + -5 * 0
$$
Получили отрицательное значение, что значит предмет не поместится в рюкзак. Соответственно от этой вершины мы не будем продолжать поиск.

Оценка перспективности правого потомка - 

$$
27 + 13 * 0 = 27
$$

``` mermaid
flowchart TD
A(80)
B(62)
C(60)
D(46)
E(44)
F(42)
G(40)
H(34)
I(30)
J(30)
K(26)
L(28)
M(24)
N(24)
AK(20)
O(30,5)
P(28)
R(0)
S(28,75)
T(24,5)
U(22)
V(25,5)
W(23)
X(0)
Y(27)
A -- +F--> B
A -- -F--> C
B -- +E--> D
B -- -E--> E
C -- +E--> F
C -- -E--> G
D -- +D--> H
D -- -D--> I
E -- +D--> J
E -- -D--> K
F -- +D--> L
F -- -D--> M
G -- +D--> N
G -- -D--> AK
H -- +B--> O
H -- -B--> P
O -- +A--> R
O -- -A--> S
I -- +B--> T
I -- -B--> U
J -- +B--> V
J -- -B--> W
S -- +C--> X
S -- -C--> Y

style R fill:#FF0000
style X fill:#FF0000
style L fill:#4f4f
style P fill:#4f4f
```
Самые перспективные вершины - 28.

Оценка перспективности левых потомков -

$$
14 + 5 + (20 - 11) * \frac{1}{2} = 19 + 9 * \frac{1}{2} = 23,5
$$
$$
22 + 5 + (20 - 18) * \frac{1}{4} = 27 + 6 * \frac{1}{7} = 27,5
$$

Оценка перспективности правых потомов - 

$$
14 + 14 * \frac{1}{2} = 21
$$

$$
22 + 12 * \frac{1}{4} = 25
$$

``` mermaid
flowchart TD
A(80)
B(62)
C(60)
D(46)
E(44)
F(42)
G(40)
H(34)
I(30)
J(30)
K(26)
L(28)
M(24)
N(24)
AK(20)
O(30,5)
P(28)
R(0)
S(28,75)
T(23)
U(22)
V(24)
W(23)
X(0)
Y(27)
AA(23,5)
AB(21)
AC(27,5)
AD(25)
A -- +F--> B
A -- -F--> C
B -- +E--> D
B -- -E--> E
C -- +E--> F
C -- -E--> G
D -- +D--> H
D -- -D--> I
E -- +D--> J
E -- -D--> K
F -- +D--> L
F -- -D--> M
G -- +D--> N
G -- -D--> AK
H -- +B--> O
H -- -B--> P
O -- +A--> R
O -- -A--> S
I -- +B--> T
I -- -B--> U
J -- +B--> V
J -- -B--> W
S -- +C--> X
S -- -C--> Y
L -- +B--> AA
L -- -B--> AB
P -- +A--> AC
P -- -A--> AD

style R fill:#FF0000
style X fill:#FF0000
style AC fill:#4f4f
```

Самая перспективная вершина - 27,5.

Оценка перспективности левого потомка -

$$
27 + 3 + (20 - 30) * 0 = 30 + -10 * 0
$$
Получили отрицательное значение, что значит предмет не поместится в рюкзак. Соответственно от этой вершины мы не будем продолжать поиск.

Оценка перспективности правого потомка - 

$$
27 + 2 * 0 = 27
$$

``` mermaid
flowchart TD
A(80)
B(62)
C(60)
D(46)
E(44)
F(42)
G(40)
H(34)
I(30)
J(30)
K(26)
L(28)
M(24)
N(24)
AK(20)
O(30,5)
P(28)
R(0)
S(28,75)
T(23)
U(22)
V(24)
W(23)
X(0)
Y(27)
AA(23,5)
AB(21)
AC(27,5)
AD(25)
AE(0)
AF(27)
A -- +F--> B
A -- -F--> C
B -- +E--> D
B -- -E--> E
C -- +E--> F
C -- -E--> G
D -- +D--> H
D -- -D--> I
E -- +D--> J
E -- -D--> K
F -- +D--> L
F -- -D--> M
G -- +D--> N
G -- -D--> AK
H -- +B--> O
H -- -B--> P
O -- +A--> R
O -- -A--> S
I -- +B--> T
I -- -B--> U
J -- +B--> V
J -- -B--> W
S -- +C--> X
S -- -C--> Y
L -- +B--> AA
L -- -B--> AB
P -- +A--> AC
P -- -A--> AD
AC -- +A--> AE
AC -- -A--> AF

style R fill:#FF0000
style X fill:#FF0000
style AE fill:#FF0000
style Y fill:#4f4f
style AF fill:#4f4f
```

Поскольку мы опустились до самого нижнего уровня (рассмотрели все предметы) и вершина на самом нижнем уровне является самой перспективной, то это и будет ответом.

Чтобы восстановить все положенные в рюкзак предметы пройдемся по ребрам, которые привели нас к ответу.

## Ответ
В рюкзак пойдут предметы B, D, E, F или A, D, E, F. Максимальная стоимость рюкзака: 5 + 8 + 6 + 8 = 27.
